<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">


<!-- Mirrored from www.zi-han.net/theme/hplus/form_file_upload.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Jan 2016 14:19:33 GMT -->
<head th:include="include :: header"></head>
<link href="/css/plugins/dropzone/basic.css" th:href="@{/css/plugins/dropzone/basic.css}" rel="stylesheet">
<link href="/css/plugins/dropzone/dropzone.css" th:href="@{/css/plugins/dropzone/dropzone.css}" rel="stylesheet">
<link href="/css/animate.min.css" th:href="@{/css/animate.min.css}" rel="stylesheet">
<link href="/css/style.min862f.css?v=4.1.0" th:href="@{/css/style.min862f.css?v=4.1.0}" rel="stylesheet">
<link href="/css/font-awesome.min93e3.css?v=4.4.0" th:href="@{/css/font-awesome.min93e3.css?v=4.4.0}" rel="stylesheet">
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeIn">
    <div class="">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>文件上传</h5>
                </div>
                <div class="">
                    <form id="my-awesome-dropzone" enctype="multipart/form-data"
                          class="dropzone" action="/enterprise_pro/upload_doc">
                        <input type="hidden" th:value="${taskId}" name="taskId" id="taskId"/>
                        <input type="hidden" th:value="${expertUid}" name="expertUid" id="expertUid"/>
                        <input type="hidden" value="expert_sign" name="fileType" id="fileType"/>
                        <input type="hidden" th:value="${trIndex}" name="trIndex" id="trIndex"/>

                        <div class="dropzone-previews"></div>
                        <div class="dz-default dz-message">
                            将文件放在此处或单击以上传
                        </div>
                        <button type="submit" class="btn btn-primary pull-right">提交</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/js/jquery.min.js?v=2.1.4"></script>
<script src="/js/bootstrap.min.js?v=3.3.6"></script>
<!--<script src="/js/content.min.js?v=1.0.0"></script>-->
<script src="/js/plugins/dropzone/dropzone.js"></script>
<script>


    $(document).ready(function () {

        Dropzone.options.myAwesomeDropzone = {
            addRemoveLinks: true,
            autoProcessQueue: false,
            uploadMultiple: true,
            parallelUploads: 2,
            maxFiles: 1,
            maxFilesize: 4096,
            init: function () {
                var myDropzone = this;
                this.element.querySelector("button[type=submit]").addEventListener("click", function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    myDropzone.processQueue()
                });
                this.on("sendingmultiple", function () {
                });
                this.on("successmultiple", function (files, response) {
                    console.log("successmultiple===>", response);
                    var fileUrl = response.fileUrl;
                    var trIndex = $("#trIndex").val();
                    console.log("AllData=" + fileUrl+"," + trIndex);

                    let imgTag = "<img src=\""+fileUrl+"\" width='75' height='40' >";
                    console.log(parent.$("#signImg_"+trIndex).html());
                    parent.$("#signImg_"+trIndex).html(imgTag);

                    let index = parent.layer.getFrameIndex(window.name); //获取当前窗口的name
                    parent.layer.close(index);//关闭窗口
                });
                this.on("success", function (files, response) {
                    console.log("success--aaa-->", response);
                    location.reload();
                });
                this.on("errormultiple", function (files, response) {
                })
            }
        }

    });


    /***
     * 删除文件
     * @param id
     */
    function delUploadDoc(that, id) {
        layer.confirm('确定要删除选中的记录？', {
            btn: ['确定', '取消']
        }, function () {
            $.ajax({
                cache: true,
                type: "POST",
                url: "/petroleumEngineering/removeQualityFile/confirm",
                data: {
                    id: id
                },
                async: false,
                error: function (request) {
                    parent.layer.alert("Connection error");
                },
                success: function (data) {
                    if (data.code == 0) {
                        $(that).parent().parent().parent().remove();
                    }
                    layer.msg(data.msg);
                }
            });
        })
    }
</script>
<!--<script type="text/javascript" src="http://tajs.qq.com/stats?sId=9051096" charset="UTF-8"></script>-->
</body>


<!-- Mirrored from www.zi-han.net/theme/hplus/form_file_upload.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Jan 2016 14:19:35 GMT -->
</html>
